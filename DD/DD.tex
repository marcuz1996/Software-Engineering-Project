\documentclass[12pt,a4paper]{article}
\usepackage[latin1]{inputenc}
\usepackage{float}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{amssymb}
\usepackage{graphicx}
\usepackage[hidelinks]{hyperref}
\usepackage{changepage}
\usepackage{subfig}
\usepackage{placeins}



\author{Davide Cocco - 944122\\
	Marco Gasperini - 944922}
\date{A.Y. 2019/2020 - Prof. Di Nitto Elisabetta}


\title{
	\textbf{\Huge{SafeStreets}} \\
	\large Design Document
}

\begin {document}

	\begin{figure}
		\centering
		\includegraphics[width=1.0\linewidth]{Images/polimi.jpg}
	\end{figure}

	\maketitle
	\newpage
	\tableofcontents
	\newpage

\section{INTRODUCTION}
\subsection{Purpose}
This \texttt{Design Document (DD)} for the SafeStreets software will provide a functional description of the system by describing its architecture. 
It will eventually by used by the development team as a blueprint to guide the engineering of the application.
\subsection{Scope}
The main objective of the S2B will be assisting (thus not substituting) authorities and officers in handling traffic violations though a crowd-sourced platform in which civilians can participate. 
A mobile application will allow users, both civilians and officers, to report violations through the use of the camera and the GPS, sending the data to authorities who will process such reports. 
Law enforcement will be aided by a data mining system which will produce relevant data about the registered violations, and the S2B will be able to automatically compile a ticket and send it to
the municipality's VLA as soon as an officer personally convalidates a violation.
\subsection{Definitions, Acronyms, Abbreviations}
\subsubsection{Definitions}
\begin{itemize}
\item \texttt{Violation | Offence:} we will strictly refer to any kind of static traffic violation, especially parking violations. 
\item \texttt{Authority:} a law enforcement authority which is manages traffic violations, it could be the local police, the traffic wardens etc. We will refer with this term also to the personnel which operates the web application in the authorities' headquarters.
\item \texttt{User:} refers to the users of the mobile application, that is officers and civilians.
\end{itemize}
\subsubsection{Acronyms}
\begin{itemize}
\item \texttt{S2B:} software to be.
\item \texttt{HFVZ:} high violation frequency zone.
\item \texttt{GPS:} Global Positioning System.
\item \texttt{GDPR:} General Data Protection Regulation.
\item \texttt{DW:} data warehouse.
\item \texttt{VLA:} Vehicle Licensing Authority.
\item \texttt{RACS:} Reliable Array of Cloned Services.
\item \texttt{RAPS:} Reliable Array of Partitioned Services.
\item \texttt{GUI:} Graphical User Interface.
\item \texttt{DMZ:} Demilitarized zone.
\item \texttt{ADS:} Application and Data server of the authorities.
\item \texttt{API:} Application Programming Interface.
\end{itemize}
\subsubsection{Abbreviations}
\begin{itemize}
	\item {[Gn]}: n-goal.
	\item {[Rn]}: n-requirment.
	\item {[Dn]}: n-domain assumption
	\item {App}: application.
\end{itemize}
\subsection{Revision History}
\subsection{Reference Documents}
\subsection{Document Structure}
\begin{itemize}
\item \textbf{Introduction}: includes the purpose and scope of the document along with some relevant definitions and acronyms used throughout the document.
\item \textbf{Architectural design}: this section is focused on the main components used for this system and the relationship between them, providing information about their
deployment and how they operate. it also focuses on the architectural styles and the design patterns adopted for designing the system.
\item \textbf{User interface design}: this section provides an overview on how the User Interface will look like, but it will be omitted due to the presence of this chapter in the RASD.
\item \textbf{Requirements traceability}: in this sections the requirements highlighted in the RASD document will be associated with the design elements explained in this document.
\item \textbf{Implementation, integration and test plan}: in this section we identify the order in which we plan to implement the subcomponents of the system and the order in which we plan to
integrate and test them.
\end{itemize}
\newpage
\section{ARCHITECTURAL DESIGN}
\subsection{High level overview}
			\begin{figure}[H]
				\centering
					\begin{adjustwidth}{-25mm}{-25mm}
					        \includegraphics[width=.9\paperwidth,keepaspectratio]{Images/highlevel}
					\end{adjustwidth}
				\caption{Figure 1: High Level Structure with a single Authority and a single User}
			\end{figure}
The three logical layers of the S2B can be seen in different ways depending on the actor's client, as different actors can access different services. From the \textbf{Authority's perspective} we can see the layers distributed in a \textbf{two-tier architecture}:
\begin{itemize}
\item \textbf{Presentation layer:} the GUI at the authority's web application is the tool thanks to which the authority's personnel can add officers, receive reports  from the users through HTTP calls thanks to a REST architecture embedded in the web server, and validate or invalidate them. It can thus interact 
with the Application and Data server (we will call it ADS from now on) to which it sends validated reports and receives updates, the users' clients, and rarely with the SafeStreets' server to which it sends ban requests. The web server is isolated from the outside by firewalls for increased security and to protect the ADS even if the web server is compromised.
\item \textbf{Application and Data layer:} the ADS manages application functionalities such as ticket emission and update spreading, and also data functionalities such as managing the officers' accounts in an ad-hoc database and
enriching a standalone data warehouse with reports to be processed. This server's location can either be in a central authority location for reduced latency, a municipality etc. and can be replicated through a RAPS architecture, (e.g. every authority can have its own server)
to be able to handle multiple requests in settings like big cities. 
\end{itemize}

From the \textbf{Civilian's perspective} we can see the layers distributed in a \textbf{three-tier architecture}:
\begin{itemize}
\item \textbf{Presentation layer:} the GUI at the mobile application, which can be used to file reports and send them to the Authority's web server. 
\item \textbf{Application layer:} the hypermedia at the mobile application moves from a state to another thanks to the updates received by the authorities' web servers (which are themselves sent to the authorities by their application server), that are periodically spread to the clients in the network. 
This is done to avoid having the clients know the application and data servers' access points. This way the mobile application can only contact one of the authorities' web servers and all the report processing and updating procedures are black boxed from the users perspective.
\item \textbf{Data layer:} the data server at the SafeStreets headquarters, which can be replicated through a RACS architecture to be simply scalable, manages civilian accesses and bans.
\end{itemize}

From the \textbf{Officer's perspective} we have a similar perspective as the civilian's, but officers' accounts are managed by the authorities' Application and Data server, thus we can see the layers distributed in a \textbf{two-tier architecture}:
\begin{itemize}
\item \textbf{Presentation layer:} the GUI at the mobile application which possesses the same features as the civilians' one but also includes the abilities to check a report and sign the automated ticket by inserting the officer's secret PIN, and also receives slightly different updates which
include sensitive data to be made unreadable by civilians. 
\item \textbf{Application and Data layer:} just as the civilians' perspective but in this case accounts are managed in the same location where the application functionalities resiede (as officers account aren't located in the DB at SafeStreets headquarters) and thus the application and data layers are merged.
Officers, just as civilians, only communicate directly with one of the city's authorities' web server which then handles interacting with the Application and Data server to provide the functionalities.
\end{itemize}

It is important to denote the fact that since every Authority owns a web server, calls received from the mobile units can be handled by any of the authorities for load balancing. The only logic which will be implemented at the authorities' client will be the supervised algorithm to recognize plates: this way
we can reduce latency, because since the overhead to effectively send a correct plate frame will be pretty heavy, we remove the step to contact the application server and instead execute this function directly at the authorities' location. Anything else will be handled as notifications forwarded to the ADS
to limit the computational power used at the authorities' locations.

\newpage
\subsection{Component view}
\subsubsection{High Level Component Diagram}
The following diagrams illustrate the system components and the interfaces through which they interact to fullfil their functionalities. The diagram is focused on the application tier, so the remaining tiers (the presentation tier and the data tier) are shown as black-box.
First we have done a distinction between Client side and Server side:
\begin{itemize}
\item The Client side is composed by two components, \textit{Web Application} and \textit{Mobile Application}. The first is referred to the Authorities client, latter to the User client (Civilian and Officer).
\item The Server side is composed of three main components: \textit{Authorities Web Services} manages the authorities client, through the \textit{AuthoritiesWebServices} interface server-side; the other two services are the \textit{Civilian Mobile Services} and the \textit{Officer Mobile Services} that manage  the \textit{Mobile Application} from two distinct interfaces.
\end{itemize}
\begin{figure}[H]
		\centering
			\includegraphics[width=1.0\linewidth]{Images/ComponentDiagram}
		\caption{Figure 2: Component diagram}
\end{figure}

\subsubsection{Civilian Mobile Services Projection}
Civilian Mobile Services subsystem is made of four components: Report Module, Update Module, Data Manage Module and Civilian Authentication Module.
These components provide the Mobile Application the following interfaces: ReportHandler, UpdateHandler, DataManager and AuthenticationHandler. The Modules also communicate with the map, gps services and two DBMS; the first one allows to collect the mined data about reports in the data warehouse, the latter manages user accesses of any form.
\begin{figure}[H]
				\centering
					\begin{adjustwidth}{-25mm}{-25mm}
					        \includegraphics[width=0.9\paperwidth]{Images/CivilianMobileServicesProjection}
					\end{adjustwidth}
			\end{figure}
\textbf{Module Functionalities}
\begin{itemize}
	\item \texttt{Report Module}: this module manages the reports done by Civilians and their sending to the Authority's Web server. It will allow the user to take photos of the violation, enter a description of it, timestamp it and attach geolocation coordinates thanks to the GPS API, and also handle all the communication needed for the plate recognition algorithm to work.
	\item \texttt{Update Module}: this module handles the receiving and visualizing of the mined data about HFVZs, through the Map API.
	\item \texttt{Data Manager Module}: this module allows civilians to manage their personal data (for instance changing their e-mail address or password).
	\item \texttt{Civilian Authentication Module}: this module handles the registration and login requests by civilians, and thus providing the effects of an eventual ban.
\end{itemize}
\newpage
\subsubsection{Officer Mobile Services Projection}
Officer Mobile Services subsystem is an enriched version of the civilian one to accomodate the advanced functions accessible to officers. It is made of four components: Report Module, Update Module, Check Report Module and Officer Authentication Module.
The Report Module works in the same way as the civilian mobile services, while the Update Module possesses quite a few different features to assist the officer. The Check Report Module manages the practice of checking violations by the officer
which might eventually result in a ticket being compiled. The Officer Authentication Module communicates with the Authorities Web Server and not with the SafeStreets server because officer data is kept in the ADS. 
\begin{figure}[H]
				\centering
					\begin{adjustwidth}{-25mm}{-25mm}
					        \includegraphics[width=0.9\paperwidth]{Images/OfficerMobileServicesProjection}
					\end{adjustwidth}
			\end{figure}
\textbf{Module Functionalities}
Pretty much the same as the Civilian Mobile Services:
\begin{itemize}
	\item \texttt{Report Module}: works in the same way as the Civilian's one, as officers will also be able to report violations.
	\item \texttt{Update Module}: just as the Civilian's one, but enriched with more updates that should only be accessible to law enforcement agents, such as the most egregious offenders list, newly added reports to the map, etc.
	\item \texttt{Check Report Module}: this module allows the officers to confirm the presence of a violation (and the correctness of the plate shown in the report) and enter a secret PIN to allow the emission of a ticket.
	\item \texttt{Officer Authentication Module}: this module handles the registration and login requests by officers.

\end{itemize}
\newpage
\subsubsection{Authorities Web Services Projection}
The Authorities Web Services are carried out by the Web Server and the ADS, which implements most functions of the application. Five Modules will be implemented to fulfill every functionality: Validation Report, Authority Update, Officer Registration, Officer Authentication, Ticket Emission. Web Server and ADS are strongly intertwined to provide the functionalities which all the three actors' clients need: the web server is in fact an interface which provides a layer for communication for the clients to interact with the ADS, for enhanced security, as every HTTP call which eventually has to reach the ADS to execute some logic has to pass through the web server at some authority's location.
\begin{figure}[H]
				\centering
					\begin{adjustwidth}{-25mm}{-25mm}
					        \includegraphics[width=0.9\paperwidth]{Images/AuthoritiesServicesProjection}
					\end{adjustwidth}
			\end{figure}
\textbf{Module Functionalities}
\begin{itemize}
	\item \texttt{Validation Report Module}: this module handles the functionality for validating reports by the authority's personnel and the subsequent adding to the DW.  Also the issuing of bans which is performable while invalidating reports.
	\item \texttt{Authority Update Module}: this module not only handles the receiving of updates by the ADS at the web server location (the updates are the same received by the officers, plus the list of currently active officers), but also the mining which will be run in the ADS by periodically querying the DW to retrieve the data which will be packed to form the updates, that will be sent to the web servers and spread by them to the mobile units.
	\item \texttt{Officer Registration Module}: allows the authority to add new officers, communicating the addition both to the officer via mail and to the ADS. Also manages the first insertion of the secret pin by the officer.
	\item \texttt{Officer Authentication Module}: this module authenticates the officers' login requests from the Officer Authentication Module of the Officer Services, and the pin insertion from the Check Report module.
\end{itemize}
\newpage
\subsubsection{Complete Component Diagram}
This diagram shows the interactions between all the subsystems of the application for better clarity. The presence of multiple REST APIs instead of a single comprehensive one has been modeled to show the different connections between modules without ambiguity.
\begin{figure}[H]
				\centering
					\begin{adjustwidth}{-25mm}{-25mm}
					        \includegraphics[width=0.95\paperwidth]{Images/OverallComponent}
					\end{adjustwidth}
			\end{figure}

\subsection{Deployment view}
\subsection{Runtime view: You can use sequence diagrams to describe the way components interact to accomplish specific tasks typically related to your use cases}
\subsection{Component interfaces}
\subsubsection{External Interfaces}
SafeStreets will make use of some Application Programming Interfaces to simplify the implementation, since these components are largely used and compatible with the majority of the devices currently on the market:
\begin{itemize}
\item \texttt{Maps API} to have a visual representation of users' reports and HFVZs, to help Officers in finding a report that coud be confirmed or rejected. For our purpose the Google Maps API is perfectly suitable, since it can be embedded in both Android and iOS applications.
\item \texttt{GPS API} to geolocate the reports made by users and  avoid the possibility of forging the location, which could happen if users manually enters it. GPS will also provide the application with precise timestamps for the reports.
\item \texttt{REST API} every distributed component will be provided with a REST API, especially mobile clients will exploit it to interact with the web server at the Authority's location, which is the only layer visible to them. Also the SafeStreets data server's services and the ADS's will be invokable through a REST interface. Spring Boot could be used as a versatile, easy to implement solution to build a functioning REST architecture across all subsystems.
\item \texttt{DBMS API} will be used to read and write all the database components:
\item one at the SafeStreets server which manages civilian accounts;
\item one DW at the ADS location which holds records for all reports ever compiled and is queried to create the updates;
\item another one at the ADS location which manages officer accounts.
We will use MySQL as the DBMS, which will be manipulated directly from the software from the Hibernate API which can be easily configured to work with Spring Boot for simplicity and performance.
\item \texttt{E-Mail API} to send an Email to the officers added to the SafeStreets project and to send the compiled ticket to the VLA. 
\end{itemize}
\subsection{Selected architectural styles and patterns: Please explain which styles/patterns you used, why, and how}
\subsection{Other design decisions}
\section{USER INTERFACE DESIGN: Provide an overview on how the user interface(s) of your system will look like; if you have included this part in the RASD, you can simply refer to what you have already done, possibly, providing here some extensions if applicable.}
\section{REQUIREMENTS TRACEABILITY: Explain how the requirements you have defined in the RASD map to the design elements that you have defined in this document.}
\section{IMPLEMENTATION, INTEGRATION AND TEST PLAN: Identify here the order in which you plan to implement the subcomponents of your system and the order in which you plan to integrate such subcomponents and test the integration.}
\section{EFFORT SPENT}
\begin{itemize}
\item {Davide Cocco}
 \begin{center}
			\begin{tabular}{| c | l | c |}
				\hline
				\textbf{Day} & \textbf{Subject} & \textbf{Hours} \\ \hline
				14/11/2019 & High level components & 3 \\ \hline
				19/11/2019 & Component view & 4 \\ \hline
				Total & & ** \\ \hline
			\end{tabular}
		\end{center}
\item {Marco Gasperini}
\begin{center}
			\begin{tabular}{| c | l | c |}
				\hline
				\textbf{Day} & \textbf{Subject} & \textbf{Hours} \\ \hline
				14/11/2019 & Purpose and Scope & 1 \\ \hline
				19/11/2019 & Component view & 5 \\ \hline
				Total & & ** \\ \hline
			\end{tabular}
\end{center}
\end{itemize}
\section{References}

\end {document}